(()=>{var et=(t,e)=>Array(Math.abs(e)+1).join(t);function g(t,e,o){return function(...n){return console.warn(`${t} is deprecated. Use ${e}.`),o.apply(this,n)}}function nt(t){return t!==null&&typeof t=="object"&&typeof t.name=="string"}function ot(t){return t!==null&&typeof t=="object"&&typeof t.step=="number"&&typeof t.alt=="number"}var Qt=[0,2,4,-1,1,3,5],Yt=Qt.map(t=>Math.floor(t*7/12));function Zt(t){let{step:e,alt:o,oct:n,dir:r=1}=t,i=Qt[e]+7*o;if(n===void 0)return[r*i];let s=n-Yt[e]-4*o;return[r*i,r*s]}var wn=[3,0,4,1,5,2,6];function Jt(t){let[e,o,n]=t,r=wn[Nn(e)],i=Math.floor((e+1)/7);if(o===void 0)return{step:r,alt:i,dir:n};let s=o+4*i+Yt[r];return{step:r,alt:i,oct:s,dir:n}}function Nn(t){let e=(t+1)%7;return e<0?7+e:e}var Wt={empty:!0,name:"",pc:"",acc:""},te=new Map,Sn=t=>"CDEFGAB".charAt(t),rt=t=>t<0?et("b",-t):et("#",t),it=t=>t[0]==="b"?-t.length:t.length;function f(t){let e=te.get(t);if(e)return e;let o=typeof t=="string"?In(t):ot(t)?f(Cn(t)):nt(t)?f(t.name):Wt;return te.set(t,o),o}var En=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function _t(t){let e=En.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function ee(t){return f(Jt(t))}var Tn=(t,e)=>(t%e+e)%e,At=[0,2,4,5,7,9,11];function In(t){let e=_t(t);if(e[0]===""||e[3]!=="")return Wt;let o=e[0],n=e[1],r=e[2],i=(o.charCodeAt(0)+3)%7,s=it(n),a=r.length?+r:void 0,c=Zt({step:i,alt:s,oct:a}),m=o+n+r,l=o+n,h=(At[i]+s+120)%12,d=a===void 0?Tn(At[i]+s,12)-12*99:At[i]+s+12*(a+1),u=d>=0&&d<=127?d:null,y=a===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:n,alt:s,chroma:h,coord:c,freq:y,height:d,letter:o,midi:u,name:m,oct:a,pc:l,step:i}}function Cn(t){let{step:e,alt:o,oct:n}=t,r=Sn(e);if(!r)return"";let i=r+rt(o);return n||n===0?i+n:i}var vt={empty:!0,name:"",acc:""},Dn="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",$n="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Fn=new RegExp("^"+Dn+"|"+$n+"$");function Vn(t){let e=Fn.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var ne={};function b(t){return typeof t=="string"?ne[t]||(ne[t]=kn(t)):ot(t)?b(Rn(t)):nt(t)?b(t.name):vt}var oe=[0,2,4,5,7,9,11],re="PMMPPMM";function kn(t){let e=Vn(t);if(e[0]==="")return vt;let o=+e[0],n=e[1],r=(Math.abs(o)-1)%7,i=re[r];if(i==="M"&&n==="P")return vt;let s=i==="M"?"majorable":"perfectable",a=""+o+n,c=o<0?-1:1,m=o===8||o===-8?o:c*(r+1),l=On(s,n),h=Math.floor((Math.abs(o)-1)/7),d=c*(oe[r]+l+12*h),u=(c*(oe[r]+l)%12+12)%12,y=Zt({step:r,alt:l,oct:h,dir:c});return{empty:!1,name:a,num:o,q:n,step:r,alt:l,dir:c,type:s,simple:m,semitones:d,chroma:u,coord:y,oct:h}}function jt(t){let[e,o=0]=t,r=e*7+o*12<0?[-e,-o,-1]:[e,o,1];return b(Jt(r))}function On(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function Rn(t){let{step:e,alt:o,oct:n=0,dir:r}=t;if(!r)return"";let i=e+1+7*n,s=r<0?"-":"",a=re[e]==="M"?"majorable":"perfectable";return s+i+qn(a,o)}function qn(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?et("A",e):et("d",t==="perfectable"?e:e+1)}function _(t,e){let o=f(t),n=b(e);if(o.empty||n.empty)return"";let r=o.coord,i=n.coord,s=r.length===1?[r[0]+i[0]]:[r[0]+i[0],r[1]+i[1]];return ee(s).name}function q(t,e){let o=f(t),n=f(e);if(o.empty||n.empty)return"";let r=o.coord,i=n.coord,s=i[0]-r[0],a=r.length===2&&i.length===2?i[1]-r[1]:-Math.floor(s*7/12);return jt([s,a]).name}function Bn(t,e){let o=[];for(;e--;o[e]=e+t);return o}function Gn(t,e){let o=[];for(;e--;o[e]=t-e);return o}function st(t,e){return t<e?Bn(t,e-t+1):Gn(t,t-e+1)}function D(t,e){let o=e.length,n=(t%o+o)%o;return e.slice(n,o).concat(e.slice(0,n))}function wt(t){return t.filter(e=>e===0||e)}var j={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},ie=t=>Number(t).toString(2),se=t=>parseInt(t,2),zn=/^[01]{12}$/;function ae(t){return zn.test(t)}var Un=t=>typeof t=="number"&&t>=0&&t<=4095,Hn=t=>t&&ae(t.chroma),ce={[j.chroma]:j};function w(t){let e=ae(t)?t:Un(t)?ie(t):Array.isArray(t)?Xn(t):Hn(t)?t.chroma:j.chroma;return ce[e]=ce[e]||Kn(e)}var Kr=g("Pcset.pcset","Pcset.get",w);var Qn=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function Nt(t){let e=[];for(let o=0;o<12;o++)t.charAt(o)==="1"&&e.push(Qn[o]);return e}function at(t,e=!0){let n=w(t).chroma.split("");return wt(n.map((r,i)=>{let s=D(i,n);return e&&s[0]==="0"?null:s.join("")}))}function L(t){let e=w(t).setNum;return o=>{let n=w(o).setNum;return e&&e!==n&&(n&e)===n}}function B(t){let e=w(t).setNum;return o=>{let n=w(o).setNum;return e&&e!==n&&(n|e)===n}}function Yn(t){let e=t.split("");return e.map((o,n)=>D(n,e).join(""))}function Kn(t){let e=se(t),o=Yn(t).map(se).filter(i=>i>=2048).sort()[0],n=ie(o),r=Nt(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:n,intervals:r}}function Xn(t){if(t.length===0)return j.chroma;let e,o=[0,0,0,0,0,0,0,0,0,0,0,0];for(let n=0;n<t.length;n++)e=f(t[n]),e.empty&&(e=b(t[n])),e.empty||(o[e.chroma]=1);return o.join("")}var Zn=[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7 \u0394 ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 \u03949 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 \u0394#4 \u0394#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -\u03947 m\u0394 -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim \xB0 o"],["1P 3m 5d 7d","diminished seventh","dim7 \xB07 o7"],["1P 3m 5d 7m","half-diminished","m7b5 \xF8 -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 \u03949#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],Jn={...j,name:"",quality:"Unknown",intervals:[],aliases:[]},St=[],G={};function It(t){return G[t]||Jn}var Zr=g("ChordType.chordType","ChordType.get",It);function S(){return St.slice()}var Jr=g("ChordType.entries","ChordType.all",S);function eo(t,e,o){let n=to(t),r={...w(t),name:o||"",quality:n,intervals:t,aliases:e};St.push(r),r.name&&(G[r.name]=r),G[r.setNum]=r,G[r.chroma]=r,r.aliases.forEach(i=>Wn(r,i))}function Wn(t,e){G[e]=t}function to(t){let e=o=>t.indexOf(o)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}Zn.forEach(([t,e,o])=>eo(t.split(" "),o.split(" "),e));St.sort((t,e)=>t.setNum-e.setNum);var no=t=>{let e=t.reduce((o,n)=>{let r=f(n).chroma;return r!==void 0&&(o[r]=o[r]||f(n).name),o},{});return o=>e[o]};function Ct(t){let e=t.map(n=>f(n).pc).filter(n=>n);return f.length===0?[]:oo(e,1).filter(n=>n.weight).sort((n,r)=>r.weight-n.weight).map(n=>n.name)}function oo(t,e){let o=t[0],n=f(o).chroma,r=no(t),i=at(t,!1),s=[];return i.forEach((a,c)=>{S().filter(l=>l.chroma===a).forEach(l=>{let h=l.aliases[0],d=r(c);c!==n?s.push({weight:.5*e,name:`${d}${h}/${o}`}):s.push({weight:1*e,name:`${d}${h}`})})}),s}var ro=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 3m 4d 5d 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","\xB7superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 5d 5P 6M 7m","romanian minor"],["1P 2M 3m 4A 5P 6M 7m","dorian #4"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],io={...j,intervals:[],aliases:[]},Et=[],z={};function me(){return Et.map(t=>t.name)}function Tt(t){return z[t]||io}var si=g("ScaleDictionary.scaleType","ScaleType.get",Tt);function F(){return Et.slice()}var ai=g("ScaleDictionary.entries","ScaleType.all",F);function ao(t,e,o=[]){let n={...w(t),name:e,intervals:t,aliases:o};return Et.push(n),z[n.name]=n,z[n.setNum]=n,z[n.chroma]=n,n.aliases.forEach(r=>so(n,r)),n}function so(t,e){z[e]=t}ro.forEach(([t,e,...o])=>ao(t.split(" "),e,o));var Dt={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},co=/^(6|64|7|9|11|13)$/;function ct(t){let[e,o,n,r]=_t(t);return e===""?["",t]:e==="A"&&r==="ug"?["","aug"]:!r&&(n==="4"||n==="5")?[e+o,n]:co.test(n)?[e+o,n+r]:[e+o+n,r]}function U(t){if(t==="")return Dt;if(Array.isArray(t)&&t.length===2)return mt(t[1],t[0]);{let[e,o]=ct(t),n=mt(o,e);return n.empty?mt(t):n}}function mt(t,e,o){let n=It(t),r=f(e||""),i=f(o||"");if(n.empty||e&&r.empty||o&&i.empty)return Dt;let s=q(r.pc,i.pc),a=n.intervals.indexOf(s)+1;if(!i.empty&&!a)return Dt;let c=Array.from(n.intervals);for(let d=1;d<a;d++){let u=c[0][0],y=c[0][1],C=parseInt(u,10)+7;c.push(`${C}${y}`),c.shift()}let m=r.empty?[]:c.map(d=>_(r,d));t=n.aliases.indexOf(t)!==-1?t:n.aliases[0];let l=`${r.empty?"":r.pc}${t}${i.empty||a<=1?"":"/"+i.pc}`,h=`${e?r.pc+" ":""}${n.name}${a>1&&o?" over "+i.pc:""}`;return{...n,name:h,symbol:l,type:n.name,root:i.name,intervals:c,rootDegree:a,tonic:r.name,notes:m}}var mo=g("Chord.chord","Chord.get",U);function lo(t,e){let[o,n]=ct(t);return o?_(o,e)+n:t}function uo(t){let e=U(t),o=B(e.chroma);return F().filter(n=>o(n.chroma)).map(n=>n.name)}function fo(t){let e=U(t),o=B(e.chroma);return S().filter(n=>o(n.chroma)).map(n=>e.tonic+n.aliases[0])}function po(t){let e=U(t),o=L(e.chroma);return S().filter(n=>o(n.chroma)).map(n=>e.tonic+n.aliases[0])}var ho={getChord:mt,get:U,detect:Ct,chordScales:uo,extended:fo,reduced:po,tokenize:ct,transpose:lo,chord:mo},lt=ho;var Po=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],Mo=[];Po.forEach(([t,e,o])=>yo(t,e,o));function yo(t,e,o){Mo.push({empty:!1,dots:"",name:"",value:1/t,fraction:t<1?[1/t,1]:[1,t],shorthand:e,names:o})}var yi="P m M m M P d P m M m M".split(" ");var gi=le((t,e)=>[t[0]+e[0],t[1]+e[1]]);var xi=le((t,e)=>[t[0]-e[0],t[1]-e[1]]);function le(t){return(e,o)=>{let n=b(e).coord,r=b(o).coord;if(n&&r){let i=t(n,r);return jt(i).name}}}var Ai=Math.log(2),vi=Math.log(440);var ji="C C# D D# E F F# G G# A A# B".split(" "),wi="C Db D Eb E F Gb G Ab A Bb B".split(" ");var xo=t=>t.name,bo=t=>t.map(f).filter(e=>!e.empty);var ue=(t,e)=>t.height-e.height;function _o(t,e){return e=e||ue,bo(t).sort(e).map(xo)}function fe(t){return _o(t,ue).filter((e,o,n)=>o===0||e!==n[o-1])}var de={empty:!0,name:"",chordType:""},pe={};function $(t){return typeof t=="string"?pe[t]||(pe[t]=vo(t)):typeof t=="number"?$($t[t]||""):ot(t)?Ao(t):nt(t)?$(t.name):de}var Di=g("RomanNumeral.romanNumeral","RomanNumeral.get",$);function Ao(t){return $(rt(t.alt)+$t[t.step])}var jo=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function wo(t){return jo.exec(t)||["","","",""]}var he="I II III IV V VI VII",$t=he.split(" "),$i=he.toLowerCase().split(" ");function vo(t){let[e,o,n,r]=wo(t);if(!n)return de;let i=n.toUpperCase(),s=$t.indexOf(i),a=it(o),c=1;return{empty:!1,name:e,roman:n,interval:b({step:s,alt:a,dir:c}).name,acc:o,chordType:r,alt:a,step:s,major:n===i,oct:0,dir:c}}var A=Object.freeze([]),Pe={type:"major",tonic:"",alteration:0,keySignature:""},ut={tonic:"",grades:A,intervals:A,scale:A,chords:A,chordsHarmonicFunction:A,chordScales:A},qi={...Pe,...ut,type:"major",minorRelative:"",scale:A,secondaryDominants:A,secondaryDominantsMinorRelative:A,substituteDominants:A,substituteDominantsMinorRelative:A},Li={...Pe,type:"minor",relativeMajor:"",natural:ut,harmonic:ut,melodic:ut},Me=(t,e,o="")=>e.map((n,r)=>`${t[r]}${o}${n}`);function ft(t,e,o,n){return r=>{let i=t.map(a=>$(a).interval||""),s=i.map(a=>_(r,a));return{tonic:r,grades:t,intervals:i,scale:s,chords:Me(s,e),chordsHarmonicFunction:o.slice(),chordScales:Me(s,n," ")}}}var Bi=ft("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),Gi=ft("I II bIII IV V bVI bVII".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),zi=ft("I II bIII IV V bVI VII".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),Ui=ft("I II bIII IV V VI VII".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));var Ft=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],ye={...j,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},ge=Ft.map(No),Vt={};ge.forEach(t=>{Vt[t.name]=t,t.aliases.forEach(e=>{Vt[e]=t})});function kt(t){return typeof t=="string"?Vt[t.toLowerCase()]||ye:t&&t.name?kt(t.name):ye}var Wi=g("Mode.mode","Mode.get",kt);function So(){return ge.slice()}var ts=g("Mode.mode","Mode.all",So);function No(t){let[e,o,n,r,i,s,a]=t,c=a?[a]:[],m=Number(o).toString(2),l=Nt(m);return{empty:!1,intervals:l,modeNum:e,chroma:m,normalized:m,name:r,setNum:o,alt:n,triad:i,seventh:s,aliases:c}}function xe(t){return(e,o)=>{let n=kt(e);if(n.empty)return[];let r=D(n.modeNum,t),i=n.intervals.map(s=>_(o,s));return r.map((s,a)=>i[a]+s)}}var es=xe(Ft.map(t=>t[4])),ns=xe(Ft.map(t=>t[5]));var Io={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function be(t){if(typeof t!="string")return["",""];let e=t.indexOf(" "),o=f(t.substring(0,e));if(o.empty){let r=f(t);return r.empty?["",t]:[r.name,""]}let n=t.substring(o.name.length+1);return[o.name,n.length?n:""]}var Co=me;function I(t){let e=Array.isArray(t)?t:be(t),o=f(e[0]).name,n=Tt(e[1]);if(n.empty)return Io;let r=n.name,i=o?n.intervals.map(a=>_(o,a)):[],s=o?o+" "+r:r;return{...n,name:s,type:r,tonic:o,notes:i}}var Eo=g("Scale.scale","Scale.get",I);function To(t){let e=I(t),o=L(e.chroma);return S().filter(n=>o(n.chroma)).map(n=>n.aliases[0])}function Do(t){let e=I(t),o=B(e.chroma);return F().filter(n=>o(n.chroma)).map(n=>n.name)}function $o(t){let e=L(I(t).chroma);return F().filter(o=>e(o.chroma)).map(o=>o.name)}function _e(t){let e=t.map(r=>f(r).pc).filter(r=>r),o=e[0],n=fe(e);return D(n.indexOf(o),n)}function Fo(t){let e=I(t);if(e.empty)return[];let o=e.tonic?e.notes:e.intervals;return at(e.chroma).map((n,r)=>{let i=I(n).name;return i?[o[r],i]:["",""]}).filter(n=>n[0])}function Vo(t){let e=Array.isArray(t)?_e(t):I(t).notes,o=e.map(n=>f(n).chroma);return n=>{let r=typeof n=="number"?n:f(n).height;if(r===void 0)return;let i=r%12,s=Math.floor(r/12)-1,a=o.indexOf(i);if(a!==-1)return e[a]+s}}function ko(t){let e=Vo(t);return(o,n)=>{let r=f(o).height,i=f(n).height;return r===void 0||i===void 0?[]:st(r,i).map(e).filter(s=>s)}}var Ro={get:I,names:Co,extended:Do,modeNames:Fo,reduced:$o,scaleChords:To,scaleNotes:_e,tokenize:be,rangeOf:ko,scale:Eo},Rt=Ro;var gs=new Map;var dt="http://www.w3.org/1999/xhtml",Ot={svg:"http://www.w3.org/2000/svg",xhtml:dt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pt(t){var e=t+="",o=e.indexOf(":");return o>=0&&(e=t.slice(0,o))!=="xmlns"&&(t=t.slice(o+1)),Ot.hasOwnProperty(e)?{space:Ot[e],local:t}:t}function Bo(t){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===dt&&e.documentElement.namespaceURI===dt?e.createElement(t):e.createElementNS(o,t)}}function Go(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ht(t){var e=pt(t);return(e.local?Go:Bo)(e)}function zo(){}function Pt(t){return t==null?zo:function(){return this.querySelector(t)}}function Ae(t){typeof t!="function"&&(t=Pt(t));for(var e=this._groups,o=e.length,n=new Array(o),r=0;r<o;++r)for(var i=e[r],s=i.length,a=n[r]=new Array(s),c,m,l=0;l<s;++l)(c=i[l])&&(m=t.call(c,c.__data__,l,i))&&("__data__"in c&&(m.__data__=c.__data__),a[l]=m);return new p(n,this._parents)}function V(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Uo(){return[]}function ve(t){return t==null?Uo:function(){return this.querySelectorAll(t)}}function Ho(t){return function(){var e=t.apply(this,arguments);return e==null?[]:V(e)}}function je(t){typeof t=="function"?t=Ho(t):t=ve(t);for(var e=this._groups,o=e.length,n=[],r=[],i=0;i<o;++i)for(var s=e[i],a=s.length,c,m=0;m<a;++m)(c=s[m])&&(n.push(t.call(c,c.__data__,m,s)),r.push(c));return new p(n,r)}function we(t){return function(){return this.matches(t)}}function Mt(t){return function(e){return e.matches(t)}}var Ko=Array.prototype.find;function Xo(t){return function(){return Ko.call(this.children,t)}}function Qo(){return this.firstElementChild}function Ne(t){return this.select(t==null?Qo:Xo(typeof t=="function"?t:Mt(t)))}var Yo=Array.prototype.filter;function Zo(){return this.children}function Jo(t){return function(){return Yo.call(this.children,t)}}function Se(t){return this.selectAll(t==null?Zo:Jo(typeof t=="function"?t:Mt(t)))}function Ie(t){typeof t!="function"&&(t=we(t));for(var e=this._groups,o=e.length,n=new Array(o),r=0;r<o;++r)for(var i=e[r],s=i.length,a=n[r]=[],c,m=0;m<s;++m)(c=i[m])&&t.call(c,c.__data__,m,i)&&a.push(c);return new p(n,this._parents)}function yt(t){return new Array(t.length)}function Ce(){return new p(this._enter||this._groups.map(yt),this._parents)}function H(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}H.prototype={constructor:H,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ee(t){return function(){return t}}function Wo(t,e,o,n,r,i){for(var s=0,a,c=e.length,m=i.length;s<m;++s)(a=e[s])?(a.__data__=i[s],n[s]=a):o[s]=new H(t,i[s]);for(;s<c;++s)(a=e[s])&&(r[s]=a)}function tr(t,e,o,n,r,i,s){var a,c,m=new Map,l=e.length,h=i.length,d=new Array(l),u;for(a=0;a<l;++a)(c=e[a])&&(d[a]=u=s.call(c,c.__data__,a,e)+"",m.has(u)?r[a]=c:m.set(u,c));for(a=0;a<h;++a)u=s.call(t,i[a],a,i)+"",(c=m.get(u))?(n[a]=c,c.__data__=i[a],m.delete(u)):o[a]=new H(t,i[a]);for(a=0;a<l;++a)(c=e[a])&&m.get(d[a])===c&&(r[a]=c)}function er(t){return t.__data__}function Te(t,e){if(!arguments.length)return Array.from(this,er);var o=e?tr:Wo,n=this._parents,r=this._groups;typeof t!="function"&&(t=Ee(t));for(var i=r.length,s=new Array(i),a=new Array(i),c=new Array(i),m=0;m<i;++m){var l=n[m],h=r[m],d=h.length,u=V(t.call(l,l&&l.__data__,m,n)),y=u.length,C=a[m]=new Array(y),O=s[m]=new Array(y),X=c[m]=new Array(d);o(l,h,C,O,X,u,e);for(var N=0,E=0,Q,Y;N<y;++N)if(Q=C[N]){for(N>=E&&(E=N+1);!(Y=O[E])&&++E<y;);Q._next=Y||null}}return s=new p(s,n),s._enter=a,s._exit=c,s}function De(){return new p(this._exit||this._groups.map(yt),this._parents)}function $e(t,e,o){var n=this.enter(),r=this,i=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),o==null?i.remove():o(i),n&&r?n.merge(r).order():r}function Fe(t){if(!(t instanceof p))throw new Error("invalid merge");for(var e=this._groups,o=t._groups,n=e.length,r=o.length,i=Math.min(n,r),s=new Array(n),a=0;a<i;++a)for(var c=e[a],m=o[a],l=c.length,h=s[a]=new Array(l),d,u=0;u<l;++u)(d=c[u]||m[u])&&(h[u]=d);for(;a<n;++a)s[a]=e[a];return new p(s,this._parents)}function Ve(){for(var t=this._groups,e=-1,o=t.length;++e<o;)for(var n=t[e],r=n.length-1,i=n[r],s;--r>=0;)(s=n[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function ke(t){t||(t=nr);function e(h,d){return h&&d?t(h.__data__,d.__data__):!h-!d}for(var o=this._groups,n=o.length,r=new Array(n),i=0;i<n;++i){for(var s=o[i],a=s.length,c=r[i]=new Array(a),m,l=0;l<a;++l)(m=s[l])&&(c[l]=m);c.sort(e)}return new p(r,this._parents).order()}function nr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Re(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Oe(){return Array.from(this)}function qe(){for(var t=this._groups,e=0,o=t.length;e<o;++e)for(var n=t[e],r=0,i=n.length;r<i;++r){var s=n[r];if(s)return s}return null}function Le(){let t=0;for(let e of this)++t;return t}function Be(){return!this.node()}function Ge(t){for(var e=this._groups,o=0,n=e.length;o<n;++o)for(var r=e[o],i=0,s=r.length,a;i<s;++i)(a=r[i])&&t.call(a,a.__data__,i,r);return this}function or(t){return function(){this.removeAttribute(t)}}function rr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ir(t,e){return function(){this.setAttribute(t,e)}}function sr(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ar(t,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttribute(t):this.setAttribute(t,o)}}function cr(t,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,o)}}function ze(t,e){var o=pt(t);if(arguments.length<2){var n=this.node();return o.local?n.getAttributeNS(o.space,o.local):n.getAttribute(o)}return this.each((e==null?o.local?rr:or:typeof e=="function"?o.local?cr:ar:o.local?sr:ir)(o,e))}function gt(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function mr(t){return function(){this.style.removeProperty(t)}}function lr(t,e,o){return function(){this.style.setProperty(t,e,o)}}function ur(t,e,o){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,o)}}function Ue(t,e,o){return arguments.length>1?this.each((e==null?mr:typeof e=="function"?ur:lr)(t,e,o??"")):fr(this.node(),t)}function fr(t,e){return t.style.getPropertyValue(e)||gt(t).getComputedStyle(t,null).getPropertyValue(e)}function dr(t){return function(){delete this[t]}}function pr(t,e){return function(){this[t]=e}}function hr(t,e){return function(){var o=e.apply(this,arguments);o==null?delete this[t]:this[t]=o}}function He(t,e){return arguments.length>1?this.each((e==null?dr:typeof e=="function"?hr:pr)(t,e)):this.node()[t]}function Ke(t){return t.trim().split(/^|\s+/)}function qt(t){return t.classList||new Xe(t)}function Xe(t){this._node=t,this._names=Ke(t.getAttribute("class")||"")}Xe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Qe(t,e){for(var o=qt(t),n=-1,r=e.length;++n<r;)o.add(e[n])}function Ye(t,e){for(var o=qt(t),n=-1,r=e.length;++n<r;)o.remove(e[n])}function Pr(t){return function(){Qe(this,t)}}function Mr(t){return function(){Ye(this,t)}}function yr(t,e){return function(){(e.apply(this,arguments)?Qe:Ye)(this,t)}}function Ze(t,e){var o=Ke(t+"");if(arguments.length<2){for(var n=qt(this.node()),r=-1,i=o.length;++r<i;)if(!n.contains(o[r]))return!1;return!0}return this.each((typeof e=="function"?yr:e?Pr:Mr)(o,e))}function gr(){this.textContent=""}function xr(t){return function(){this.textContent=t}}function br(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Je(t){return arguments.length?this.each(t==null?gr:(typeof t=="function"?br:xr)(t)):this.node().textContent}function _r(){this.innerHTML=""}function Ar(t){return function(){this.innerHTML=t}}function vr(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function We(t){return arguments.length?this.each(t==null?_r:(typeof t=="function"?vr:Ar)(t)):this.node().innerHTML}function jr(){this.nextSibling&&this.parentNode.appendChild(this)}function tn(){return this.each(jr)}function wr(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function en(){return this.each(wr)}function nn(t){var e=typeof t=="function"?t:ht(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Nr(){return null}function on(t,e){var o=typeof t=="function"?t:ht(t),n=e==null?Nr:typeof e=="function"?e:Pt(e);return this.select(function(){return this.insertBefore(o.apply(this,arguments),n.apply(this,arguments)||null)})}function Sr(){var t=this.parentNode;t&&t.removeChild(this)}function rn(){return this.each(Sr)}function Ir(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Cr(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function sn(t){return this.select(t?Cr:Ir)}function an(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Er(t){return function(e){t.call(this,e,this.__data__)}}function Tr(t){return t.trim().split(/^|\s+/).map(function(e){var o="",n=e.indexOf(".");return n>=0&&(o=e.slice(n+1),e=e.slice(0,n)),{type:e,name:o}})}function Dr(t){return function(){var e=this.__on;if(!!e){for(var o=0,n=-1,r=e.length,i;o<r;++o)i=e[o],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++n]=i;++n?e.length=n:delete this.__on}}}function $r(t,e,o){return function(){var n=this.__on,r,i=Er(e);if(n){for(var s=0,a=n.length;s<a;++s)if((r=n[s]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=o),r.value=e;return}}this.addEventListener(t.type,i,o),r={type:t.type,name:t.name,value:e,listener:i,options:o},n?n.push(r):this.__on=[r]}}function cn(t,e,o){var n=Tr(t+""),r,i=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,m=a.length,l;c<m;++c)for(r=0,l=a[c];r<i;++r)if((s=n[r]).type===l.type&&s.name===l.name)return l.value}return}for(a=e?$r:Dr,r=0;r<i;++r)this.each(a(n[r],e,o));return this}function mn(t,e,o){var n=gt(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,o):(r=n.document.createEvent("Event"),o?(r.initEvent(e,o.bubbles,o.cancelable),r.detail=o.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Fr(t,e){return function(){return mn(this,t,e)}}function Vr(t,e){return function(){return mn(this,t,e.apply(this,arguments))}}function ln(t,e){return this.each((typeof e=="function"?Vr:Fr)(t,e))}function*un(){for(var t=this._groups,e=0,o=t.length;e<o;++e)for(var n=t[e],r=0,i=n.length,s;r<i;++r)(s=n[r])&&(yield s)}var K=[null];function p(t,e){this._groups=t,this._parents=e}function kr(){return new p([[document.documentElement]],K)}function Rr(){return this}p.prototype=kr.prototype={constructor:p,select:Ae,selectAll:je,selectChild:Ne,selectChildren:Se,filter:Ie,data:Te,enter:Ce,exit:De,join:$e,merge:Fe,selection:Rr,order:Ve,sort:ke,call:Re,nodes:Oe,node:qe,size:Le,empty:Be,each:Ge,attr:ze,style:Ue,property:He,classed:Ze,text:Je,html:We,raise:tn,lower:en,append:nn,insert:on,remove:rn,clone:sn,datum:an,on:cn,dispatch:ln,[Symbol.iterator]:un};function k(t){return typeof t=="string"?new p([[document.querySelector(t)]],[document.documentElement]):new p([[t]],K)}function fn(t){return typeof t=="string"?new p([document.querySelectorAll(t)],[document.documentElement]):new p([t==null?[]:V(t)],K)}var R=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],dn={A:["G##","Bbb"],"A#":["Bb"],Ab:["G#"],B:["Cb","A##"],"B#":["C"],Bb:["A#"],C:["B#","Dbb"],"C#":["Db"],D:["C##","Ebb"],"D#":["Eb"],Db:["C#"],E:["Fb","D##"],"E#":["F"],Eb:["D#"],F:["E#","Gbb"],"F#":["Gb"],G:["F##","Abb"],"G#":["Ab"],Gb:["F#"]},M=["#fb8072","#fccde5","#fdb462","#ffed6f","#ffffb3","#b3de69","#ccebc5","#80b1d3","#bc80bd","#8dd3c7","#bebada","#d9d9d9"];function pn(t,e,o=[]){let n=(t+e)%R.length,r=R[n];if(o&&!o.includes(r)){for(let i of dn[r])if(o.includes(i))return i;return}return r}function Lt(t){switch(t.length){case 3:return[M[0],M[4],M[7]];case 4:return[M[0],M[4],M[7],M[11]];case 5:return[M[0],M[4],M[7],M[11],M[2]];case 7:return[M[0],M[2],M[4],M[5],M[7],M[9],M[11]];default:return M.slice(0,t.length)}}function hn(t){if(R.includes(t))return R.indexOf(t);for(let e of dn[t])if(R.includes(e))return R.indexOf(e)}function Pn(t){return t.replace(/b/g,"\u266D").replace(/#/g,"\u266F")}function Bt(t,e,o,n,r="#cccccc",i=null,s=null,a=null){let c=t.append("svg:circle").attr("cx",e).attr("cy",o).attr("r",n).style("fill",r);i&&c.style("stroke",i),s&&c.style("stroke-width",s),a&&c.attr("title",a)}function Gt(t,e,o){let n=e.tuning,r=e.string_gauges,i=e.fret_count,s=k(t);s.selectAll("*").remove();let c=s.node().parentElement.getBoundingClientRect().width*.95,m=26,l=140,h=m*(i+1),d=l*(i+1);c=Math.min(d,Math.max(h,c));let u=c/(i+1),y=u*.65,C=y*.1,O=u*.01,X=u*.8,N=y*.5,E=y*n.length+N,Q=c-X*1.2,Y=y*(n.length-1),xn=u*.06,Z=u*.22,bn=Z*.2,J=Z*1.05,W=Z*.3;s.attr("width",c).attr("height",E);let tt=`translate(${X}, ${N})`,_n=s.append("g").attr("class","frets").attr("transform",tt),Ut=s.append("g").attr("class","fret-markers").attr("transform",tt),An=s.append("g").attr("class","strings").attr("transform",tt),Ht=s.append("g").attr("class","notes").attr("transform",tt);for(let P=0;P<=i;P++){let v=P*u,x=xn;P==0&&(x*=1.5),_n.append("svg:line").attr("x1",v).attr("y1",-C/2).attr("x2",v).attr("y2",Y+C).style("stroke","#222222").style("stroke-width",x).append("title").text(P)}for(let P of e.fret_markers){if(P>i)break;let v=P*u-u/2,x=E-N-W*3;if(P%12==0){let T=W*1.3;Bt(Ut,v+T,x,W),v-=T}Bt(Ut,v,x,W)}for(let P=0;P<n.length;P++){let v=n[P],x=P*y;An.append("svg:line").attr("x1",-O/2).attr("y1",x).attr("x2",Q+O).attr("y2",x).style("stroke","#444444").style("stroke-width",r[P]*y).append("title").text(v)}for(let P=0;P<n.length;P++){let v=hn(n[P]);for(let x=0;x<=i;x++){let T=pn(v,x,o);if(!T)continue;let bt=x*u-u*.5,Kt=P*y,Xt=bt-J*.34,vn=Kt+J*.34;T.length>1&&(Xt=bt-J*.5),Bt(Ht,bt,Kt,Z,"#ffffff","#aaaaaa",bn,T),Ht.append("svg:text").attr("x",Xt).attr("y",vn).attr("fill","#000000").style("font-size",`${J}px`).text(Pn(T))}}}var zt={guitar:{tuning:["E","B","G","D","A","E"],string_gauges:[.01,.013,.017,.026,.036,.046],fret_count:15,fret_markers:[3,5,7,9,12,15,17,19,21,24]},ukulele:{tuning:["A","E","C","G"],string_gauges:[.024,.031,.037,.026],fret_count:12,fret_markers:[5,7,10,12,15,17,19]}};var xt=k("#detected-chords"),Mn=k("#chord-notes");function yn(t){let e=Lt(t);Gt("#fretboard",zt.ukulele,t);for(let o in t)fn(`#fretboard .notes circle[title="${t[o]}"]`).style("fill",e[o])}function gn(t){xt.selectAll("*").remove();let e=lt.detect(t.split(/[,\s]+/));if(e.length){let o=e.map(n=>{let r=lt.get(n.split("/")[0]);return{name:n,notes:r.notes}});xt.append("h4").text("Detected"),xt.append("ul").selectAll("li").data(o).join("li").text(n=>`${n.name}: ${n.notes.join(", ")}`),yn(o[0].notes)}else xt.append("h4").text("No chords detected"),yn(Rt.get("A chromatic").notes)}k("#chord-detect").on("click",()=>gn(Mn.property("value")));var Or=Mn.on("change",t=>gn(t.target.value));Or.attr("value","C E G").dispatch("change");})();
