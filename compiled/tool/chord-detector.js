(()=>{var et=(t,e)=>Array(Math.abs(e)+1).join(t);function y(t,e,o){return function(...n){return console.warn(`${t} is deprecated. Use ${e}.`),o.apply(this,n)}}function nt(t){return t!==null&&typeof t=="object"&&typeof t.name=="string"}function ot(t){return t!==null&&typeof t=="object"&&typeof t.step=="number"&&typeof t.alt=="number"}var re=[0,2,4,-1,1,3,5],se=re.map(t=>Math.floor(t*7/12));function ie(t){let{step:e,alt:o,oct:n,dir:r=1}=t,s=re[e]+7*o;if(n===void 0)return[r*s];let i=n-se[e]-4*o;return[r*s,r*i]}var Vn=[3,0,4,1,5,2,6];function ae(t){let[e,o,n]=t,r=Vn[kn(e)],s=Math.floor((e+1)/7);if(o===void 0)return{step:r,alt:s,dir:n};let i=o+4*s+se[r];return{step:r,alt:s,oct:i,dir:n}}function kn(t){let e=(t+1)%7;return e<0?7+e:e}var ce={empty:!0,name:"",pc:"",acc:""},me=new Map,Rn=t=>"CDEFGAB".charAt(t),rt=t=>t<0?et("b",-t):et("#",t),st=t=>t[0]==="b"?-t.length:t.length;function u(t){let e=me.get(t);if(e)return e;let o=typeof t=="string"?qn(t):ot(t)?u(Ln(t)):nt(t)?u(t.name):ce;return me.set(t,o),o}var Fn=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function bt(t){let e=Fn.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function it(t){return u(ae(t))}var On=(t,e)=>(t%e+e)%e,vt=[0,2,4,5,7,9,11];function qn(t){let e=bt(t);if(e[0]===""||e[3]!=="")return ce;let o=e[0],n=e[1],r=e[2],s=(o.charCodeAt(0)+3)%7,i=st(n),a=r.length?+r:void 0,c=ie({step:s,alt:i,oct:a}),m=o+n+r,l=o+n,h=(vt[s]+i+120)%12,p=a===void 0?On(vt[s]+i,12)-12*99:vt[s]+i+12*(a+1),f=p>=0&&p<=127?p:null,P=a===void 0?null:Math.pow(2,(p-69)/12)*440;return{empty:!1,acc:n,alt:i,chroma:h,coord:c,freq:P,height:p,letter:o,midi:f,name:m,oct:a,pc:l,step:s}}function Ln(t){let{step:e,alt:o,oct:n}=t,r=Rn(e);if(!r)return"";let s=r+rt(o);return n||n===0?s+n:s}var jt={empty:!0,name:"",acc:""},zn="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Bn="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Gn=new RegExp("^"+zn+"|"+Bn+"$");function Un(t){let e=Gn.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var le={};function _(t){return typeof t=="string"?le[t]||(le[t]=Hn(t)):ot(t)?_(Xn(t)):nt(t)?_(t.name):jt}var ue=[0,2,4,5,7,9,11],fe="PMMPPMM";function Hn(t){let e=Un(t);if(e[0]==="")return jt;let o=+e[0],n=e[1],r=(Math.abs(o)-1)%7,s=fe[r];if(s==="M"&&n==="P")return jt;let i=s==="M"?"majorable":"perfectable",a=""+o+n,c=o<0?-1:1,m=o===8||o===-8?o:c*(r+1),l=Kn(i,n),h=Math.floor((Math.abs(o)-1)/7),p=c*(ue[r]+l+12*h),f=(c*(ue[r]+l)%12+12)%12,P=ie({step:r,alt:l,oct:h,dir:c});return{empty:!1,name:a,num:o,q:n,step:r,alt:l,dir:c,type:i,simple:m,semitones:p,chroma:f,coord:P,oct:h}}function wt(t){let[e,o=0]=t,r=e*7+o*12<0?[-e,-o,-1]:[e,o,1];return _(ae(r))}function Kn(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function Xn(t){let{step:e,alt:o,oct:n=0,dir:r}=t;if(!r)return"";let s=e+1+7*n,i=r<0?"-":"",a=fe[e]==="M"?"majorable":"perfectable";return i+s+Qn(a,o)}function Qn(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?et("A",e):et("d",t==="perfectable"?e:e+1)}function g(t,e){let o=u(t),n=_(e);if(o.empty||n.empty)return"";let r=o.coord,s=n.coord,i=r.length===1?[r[0]+s[0]]:[r[0]+s[0],r[1]+s[1]];return it(i).name}function q(t,e){let o=u(t),n=u(e);if(o.empty||n.empty)return"";let r=o.coord,s=n.coord,i=s[0]-r[0],a=r.length===2&&s.length===2?s[1]-r[1]:-Math.floor(i*7/12);return wt([i,a]).name}function Jn(t,e){let o=[];for(;e--;o[e]=e+t);return o}function Wn(t,e){let o=[];for(;e--;o[e]=t-e);return o}function at(t,e){return t<e?Jn(t,e-t+1):Wn(t,t-e+1)}function D(t,e){let o=e.length,n=(t%o+o)%o;return e.slice(n,o).concat(e.slice(0,n))}function Nt(t){return t.filter(e=>e===0||e)}var j={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},pe=t=>Number(t).toString(2),de=t=>parseInt(t,2),to=/^[01]{12}$/;function he(t){return to.test(t)}var eo=t=>typeof t=="number"&&t>=0&&t<=4095,no=t=>t&&he(t.chroma),Pe={[j.chroma]:j};function w(t){let e=he(t)?t:eo(t)?pe(t):Array.isArray(t)?io(t):no(t)?t.chroma:j.chroma;return Pe[e]=Pe[e]||so(e)}var js=y("Pcset.pcset","Pcset.get",w);var oo=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function St(t){let e=[];for(let o=0;o<12;o++)t.charAt(o)==="1"&&e.push(oo[o]);return e}function ct(t,e=!0){let n=w(t).chroma.split("");return Nt(n.map((r,s)=>{let i=D(s,n);return e&&i[0]==="0"?null:i.join("")}))}function L(t){let e=w(t).setNum;return o=>{let n=w(o).setNum;return e&&e!==n&&(n&e)===n}}function z(t){let e=w(t).setNum;return o=>{let n=w(o).setNum;return e&&e!==n&&(n|e)===n}}function ro(t){let e=t.split("");return e.map((o,n)=>D(n,e).join(""))}function so(t){let e=de(t),o=ro(t).map(de).filter(s=>s>=2048).sort()[0],n=pe(o),r=St(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:n,intervals:r}}function io(t){if(t.length===0)return j.chroma;let e,o=[0,0,0,0,0,0,0,0,0,0,0,0];for(let n=0;n<t.length;n++)e=u(t[n]),e.empty&&(e=_(t[n])),e.empty||(o[e.chroma]=1);return o.join("")}var ao=[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7 \u0394 ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 \u03949 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 \u0394#4 \u0394#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -\u03947 m\u0394 -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim \xB0 o"],["1P 3m 5d 7d","diminished seventh","dim7 \xB07 o7"],["1P 3m 5d 7m","half-diminished","m7b5 \xF8 -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 \u03949#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],co={...j,name:"",quality:"Unknown",intervals:[],aliases:[]},It=[],B={};function Ct(t){return B[t]||co}var Is=y("ChordType.chordType","ChordType.get",Ct);function S(){return It.slice()}var Cs=y("ChordType.entries","ChordType.all",S);function mo(t,e,o){let n=uo(t),r={...w(t),name:o||"",quality:n,intervals:t,aliases:e};It.push(r),r.name&&(B[r.name]=r),B[r.setNum]=r,B[r.chroma]=r,r.aliases.forEach(s=>lo(r,s))}function lo(t,e){B[e]=t}function uo(t){let e=o=>t.indexOf(o)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}ao.forEach(([t,e,o])=>mo(t.split(" "),o.split(" "),e));It.sort((t,e)=>t.setNum-e.setNum);var fo=t=>{let e=t.reduce((o,n)=>{let r=u(n).chroma;return r!==void 0&&(o[r]=o[r]||u(n).name),o},{});return o=>e[o]};function Tt(t){let e=t.map(n=>u(n).pc).filter(n=>n);return u.length===0?[]:po(e,1).filter(n=>n.weight).sort((n,r)=>r.weight-n.weight).map(n=>n.name)}function po(t,e){let o=t[0],n=u(o).chroma,r=fo(t),s=ct(t,!1),i=[];return s.forEach((a,c)=>{S().filter(l=>l.chroma===a).forEach(l=>{let h=l.aliases[0],p=r(c);c!==n?i.push({weight:.5*e,name:`${p}${h}/${o}`}):i.push({weight:1*e,name:`${p}${h}`})})}),i}var ho=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 3m 4d 5d 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","\xB7superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 5d 5P 6M 7m","romanian minor"],["1P 2M 3m 4A 5P 6M 7m","dorian #4"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],Po={...j,intervals:[],aliases:[]},Et=[],G={};function Me(){return Et.map(t=>t.name)}function Dt(t){return G[t]||Po}var Fs=y("ScaleDictionary.scaleType","ScaleType.get",Dt);function R(){return Et.slice()}var Os=y("ScaleDictionary.entries","ScaleType.all",R);function Mo(t,e,o=[]){let n={...w(t),name:e,intervals:t,aliases:o};return Et.push(n),G[n.name]=n,G[n.setNum]=n,G[n.chroma]=n,n.aliases.forEach(r=>yo(n,r)),n}function yo(t,e){G[e]=t}ho.forEach(([t,e,...o])=>Mo(t.split(" "),e,o));var $t={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},go=/^(6|64|7|9|11|13)$/;function mt(t){let[e,o,n,r]=bt(t);return e===""?["",t]:e==="A"&&r==="ug"?["","aug"]:!r&&(n==="4"||n==="5")?[e+o,n]:go.test(n)?[e+o,n+r]:[e+o+n,r]}function U(t){if(t==="")return $t;if(Array.isArray(t)&&t.length===2)return lt(t[1],t[0]);{let[e,o]=mt(t),n=lt(o,e);return n.empty?lt(t):n}}function lt(t,e,o){let n=Ct(t),r=u(e||""),s=u(o||"");if(n.empty||e&&r.empty||o&&s.empty)return $t;let i=q(r.pc,s.pc),a=n.intervals.indexOf(i)+1;if(!s.empty&&!a)return $t;let c=Array.from(n.intervals);for(let p=1;p<a;p++){let f=c[0][0],P=c[0][1],T=parseInt(f,10)+7;c.push(`${T}${P}`),c.shift()}let m=r.empty?[]:c.map(p=>g(r,p));t=n.aliases.indexOf(t)!==-1?t:n.aliases[0];let l=`${r.empty?"":r.pc}${t}${s.empty||a<=1?"":"/"+s.pc}`,h=`${e?r.pc+" ":""}${n.name}${a>1&&o?" over "+s.pc:""}`;return{...n,name:h,symbol:l,type:n.name,root:s.name,intervals:c,rootDegree:a,tonic:r.name,notes:m}}var xo=y("Chord.chord","Chord.get",U);function _o(t,e){let[o,n]=mt(t);return o?g(o,e)+n:t}function Ao(t){let e=U(t),o=z(e.chroma);return R().filter(n=>o(n.chroma)).map(n=>n.name)}function bo(t){let e=U(t),o=z(e.chroma);return S().filter(n=>o(n.chroma)).map(n=>e.tonic+n.aliases[0])}function vo(t){let e=U(t),o=L(e.chroma);return S().filter(n=>o(n.chroma)).map(n=>e.tonic+n.aliases[0])}var jo={getChord:lt,get:U,detect:Tt,chordScales:Ao,extended:bo,reduced:vo,tokenize:mt,transpose:_o,chord:xo},ut=jo;var wo=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],No=[];wo.forEach(([t,e,o])=>So(t,e,o));function So(t,e,o){No.push({empty:!1,dots:"",name:"",value:1/t,fraction:t<1?[1/t,1]:[1,t],shorthand:e,names:o})}var Ys="P m M m M P d P m M m M".split(" ");var Zs=ye((t,e)=>[t[0]+e[0],t[1]+e[1]]);var Js=ye((t,e)=>[t[0]-e[0],t[1]-e[1]]);function ye(t){return(e,o)=>{let n=_(e).coord,r=_(o).coord;if(n&&r){let s=t(n,r);return wt(s).name}}}var Io=Math.log(2),Co=Math.log(440);function Vt(t){let e=12*(Math.log(t)-Co)/Io+69;return Math.round(e*100)/100}var To="C C# D D# E F F# G G# A A# B".split(" "),Eo="C Db D Eb E F Gb G Ab A Bb B".split(" ");function I(t,e={}){if(isNaN(t)||t===-1/0||t===1/0)return"";t=Math.round(t);let n=(e.sharps===!0?To:Eo)[t%12];if(e.pitchClass)return n;let r=Math.floor(t/12)-1;return n+r}var Do=["C","D","E","F","G","A","B"],ge=t=>t.name,xe=t=>t.map(u).filter(e=>!e.empty);function $o(t){return t===void 0?Do.slice():Array.isArray(t)?xe(t).map(ge):[]}var A=u,Vo=t=>A(t).name,ko=t=>A(t).pc,Ro=t=>A(t).acc,Fo=t=>A(t).oct,Oo=t=>A(t).midi,qo=t=>A(t).freq,Lo=t=>A(t).chroma;function zo(t){return I(t)}function Bo(t){return I(Vt(t))}function Go(t){return I(Vt(t),{sharps:!0})}function Uo(t){return I(t,{sharps:!0})}var kt=g,Ho=g,_e=t=>e=>kt(e,t),Ko=_e,Ae=t=>e=>kt(t,e),Xo=Ae;function Rt(t,e){let o=A(t);if(o.empty)return"";let[n,r]=o.coord;return(r===void 0?it([n+e]):it([n+e,r])).name}var Qo=Rt,Ft=(t,e)=>t.height-e.height,Yo=(t,e)=>e.height-t.height;function be(t,e){return e=e||Ft,xe(t).sort(e).map(ge)}function Ot(t){return be(t,Ft).filter((e,o,n)=>o===0||e!==n[o-1])}var Zo=t=>{let e=A(t);return e.empty?"":I(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function Jo(t,e){let o=A(t);if(o.empty)return"";let n=A(e||I(o.midi||o.chroma,{sharps:o.alt<0,pitchClass:!0}));if(n.empty||n.chroma!==o.chroma)return"";if(o.oct===void 0)return n.pc;let r=o.chroma-o.alt,s=n.chroma-n.alt,i=r>11||s<0?-1:r<0||s>11?1:0,a=o.oct+i;return n.pc+a}var Wo={names:$o,get:A,name:Vo,pitchClass:ko,accidentals:Ro,octave:Fo,midi:Oo,ascending:Ft,descending:Yo,sortedNames:be,sortedUniqNames:Ot,fromMidi:zo,fromMidiSharps:Uo,freq:qo,fromFreq:Bo,fromFreqSharps:Go,chroma:Lo,transpose:kt,tr:Ho,transposeBy:_e,trBy:Ko,transposeFrom:Ae,trFrom:Xo,transposeFifths:Rt,trFifths:Qo,simplify:Zo,enharmonic:Jo},ft=Wo;var ve={empty:!0,name:"",chordType:""},je={};function $(t){return typeof t=="string"?je[t]||(je[t]=or(t)):typeof t=="number"?$(qt[t]||""):ot(t)?tr(t):nt(t)?$(t.name):ve}var ii=y("RomanNumeral.romanNumeral","RomanNumeral.get",$);function tr(t){return $(rt(t.alt)+qt[t.step])}var er=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function nr(t){return er.exec(t)||["","","",""]}var we="I II III IV V VI VII",qt=we.split(" "),ai=we.toLowerCase().split(" ");function or(t){let[e,o,n,r]=nr(t);if(!n)return ve;let s=n.toUpperCase(),i=qt.indexOf(s),a=st(o),c=1;return{empty:!1,name:e,roman:n,interval:_({step:i,alt:a,dir:c}).name,acc:o,chordType:r,alt:a,step:i,major:n===s,oct:0,dir:c}}var b=Object.freeze([]),Ne={type:"major",tonic:"",alteration:0,keySignature:""},pt={tonic:"",grades:b,intervals:b,scale:b,chords:b,chordsHarmonicFunction:b,chordScales:b},fi={...Ne,...pt,type:"major",minorRelative:"",scale:b,secondaryDominants:b,secondaryDominantsMinorRelative:b,substituteDominants:b,substituteDominantsMinorRelative:b},pi={...Ne,type:"minor",relativeMajor:"",natural:pt,harmonic:pt,melodic:pt},Se=(t,e,o="")=>e.map((n,r)=>`${t[r]}${o}${n}`);function dt(t,e,o,n){return r=>{let s=t.map(a=>$(a).interval||""),i=s.map(a=>g(r,a));return{tonic:r,grades:t,intervals:s,scale:i,chords:Se(i,e),chordsHarmonicFunction:o.slice(),chordScales:Se(i,n," ")}}}var di=dt("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),hi=dt("I II bIII IV V bVI bVII".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),Pi=dt("I II bIII IV V bVI VII".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),Mi=dt("I II bIII IV V VI VII".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));var Lt=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],Ie={...j,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Ce=Lt.map(sr),zt={};Ce.forEach(t=>{zt[t.name]=t,t.aliases.forEach(e=>{zt[e]=t})});function Bt(t){return typeof t=="string"?zt[t.toLowerCase()]||Ie:t&&t.name?Bt(t.name):Ie}var ji=y("Mode.mode","Mode.get",Bt);function rr(){return Ce.slice()}var wi=y("Mode.mode","Mode.all",rr);function sr(t){let[e,o,n,r,s,i,a]=t,c=a?[a]:[],m=Number(o).toString(2),l=St(m);return{empty:!1,intervals:l,modeNum:e,chroma:m,normalized:m,name:r,setNum:o,alt:n,triad:s,seventh:i,aliases:c}}function Te(t){return(e,o)=>{let n=Bt(e);if(n.empty)return[];let r=D(n.modeNum,t),s=n.intervals.map(i=>g(o,i));return r.map((i,a)=>s[a]+i)}}var Ni=Te(Lt.map(t=>t[4])),Si=Te(Lt.map(t=>t[5]));var ir={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Ee(t){if(typeof t!="string")return["",""];let e=t.indexOf(" "),o=u(t.substring(0,e));if(o.empty){let r=u(t);return r.empty?["",t]:[r.name,""]}let n=t.substring(o.name.length+1);return[o.name,n.length?n:""]}var ar=Me;function C(t){let e=Array.isArray(t)?t:Ee(t),o=u(e[0]).name,n=Dt(e[1]);if(n.empty)return ir;let r=n.name,s=o?n.intervals.map(a=>g(o,a)):[],i=o?o+" "+r:r;return{...n,name:i,type:r,tonic:o,notes:s}}var cr=y("Scale.scale","Scale.get",C);function mr(t){let e=C(t),o=L(e.chroma);return S().filter(n=>o(n.chroma)).map(n=>n.aliases[0])}function lr(t){let e=C(t),o=z(e.chroma);return R().filter(n=>o(n.chroma)).map(n=>n.name)}function ur(t){let e=L(C(t).chroma);return R().filter(o=>e(o.chroma)).map(o=>o.name)}function De(t){let e=t.map(r=>u(r).pc).filter(r=>r),o=e[0],n=Ot(e);return D(n.indexOf(o),n)}function fr(t){let e=C(t);if(e.empty)return[];let o=e.tonic?e.notes:e.intervals;return ct(e.chroma).map((n,r)=>{let s=C(n).name;return s?[o[r],s]:["",""]}).filter(n=>n[0])}function pr(t){let e=Array.isArray(t)?De(t):C(t).notes,o=e.map(n=>u(n).chroma);return n=>{let r=typeof n=="number"?n:u(n).height;if(r===void 0)return;let s=r%12,i=Math.floor(r/12)-1,a=o.indexOf(s);if(a!==-1)return e[a]+i}}function dr(t){let e=pr(t);return(o,n)=>{let r=u(o).height,s=u(n).height;return r===void 0||s===void 0?[]:at(r,s).map(e).filter(i=>i)}}var hr={get:C,names:ar,extended:lr,modeNames:fr,reduced:ur,scaleChords:mr,scaleNotes:De,tokenize:Ee,rangeOf:dr,scale:cr},Gt=hr;var Ui=new Map;var ht="http://www.w3.org/1999/xhtml",Ut={svg:"http://www.w3.org/2000/svg",xhtml:ht,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Pt(t){var e=t+="",o=e.indexOf(":");return o>=0&&(e=t.slice(0,o))!=="xmlns"&&(t=t.slice(o+1)),Ut.hasOwnProperty(e)?{space:Ut[e],local:t}:t}function gr(t){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===ht&&e.documentElement.namespaceURI===ht?e.createElement(t):e.createElementNS(o,t)}}function xr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Mt(t){var e=Pt(t);return(e.local?xr:gr)(e)}function _r(){}function yt(t){return t==null?_r:function(){return this.querySelector(t)}}function $e(t){typeof t!="function"&&(t=yt(t));for(var e=this._groups,o=e.length,n=new Array(o),r=0;r<o;++r)for(var s=e[r],i=s.length,a=n[r]=new Array(i),c,m,l=0;l<i;++l)(c=s[l])&&(m=t.call(c,c.__data__,l,s))&&("__data__"in c&&(m.__data__=c.__data__),a[l]=m);return new d(n,this._parents)}function H(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ar(){return[]}function Ve(t){return t==null?Ar:function(){return this.querySelectorAll(t)}}function br(t){return function(){return H(t.apply(this,arguments))}}function ke(t){typeof t=="function"?t=br(t):t=Ve(t);for(var e=this._groups,o=e.length,n=[],r=[],s=0;s<o;++s)for(var i=e[s],a=i.length,c,m=0;m<a;++m)(c=i[m])&&(n.push(t.call(c,c.__data__,m,i)),r.push(c));return new d(n,r)}function Re(t){return function(){return this.matches(t)}}function gt(t){return function(e){return e.matches(t)}}var vr=Array.prototype.find;function jr(t){return function(){return vr.call(this.children,t)}}function wr(){return this.firstElementChild}function Fe(t){return this.select(t==null?wr:jr(typeof t=="function"?t:gt(t)))}var Nr=Array.prototype.filter;function Sr(){return Array.from(this.children)}function Ir(t){return function(){return Nr.call(this.children,t)}}function Oe(t){return this.selectAll(t==null?Sr:Ir(typeof t=="function"?t:gt(t)))}function qe(t){typeof t!="function"&&(t=Re(t));for(var e=this._groups,o=e.length,n=new Array(o),r=0;r<o;++r)for(var s=e[r],i=s.length,a=n[r]=[],c,m=0;m<i;++m)(c=s[m])&&t.call(c,c.__data__,m,s)&&a.push(c);return new d(n,this._parents)}function xt(t){return new Array(t.length)}function Le(){return new d(this._enter||this._groups.map(xt),this._parents)}function K(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}K.prototype={constructor:K,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ze(t){return function(){return t}}function Cr(t,e,o,n,r,s){for(var i=0,a,c=e.length,m=s.length;i<m;++i)(a=e[i])?(a.__data__=s[i],n[i]=a):o[i]=new K(t,s[i]);for(;i<c;++i)(a=e[i])&&(r[i]=a)}function Tr(t,e,o,n,r,s,i){var a,c,m=new Map,l=e.length,h=s.length,p=new Array(l),f;for(a=0;a<l;++a)(c=e[a])&&(p[a]=f=i.call(c,c.__data__,a,e)+"",m.has(f)?r[a]=c:m.set(f,c));for(a=0;a<h;++a)f=i.call(t,s[a],a,s)+"",(c=m.get(f))?(n[a]=c,c.__data__=s[a],m.delete(f)):o[a]=new K(t,s[a]);for(a=0;a<l;++a)(c=e[a])&&m.get(p[a])===c&&(r[a]=c)}function Er(t){return t.__data__}function Be(t,e){if(!arguments.length)return Array.from(this,Er);var o=e?Tr:Cr,n=this._parents,r=this._groups;typeof t!="function"&&(t=ze(t));for(var s=r.length,i=new Array(s),a=new Array(s),c=new Array(s),m=0;m<s;++m){var l=n[m],h=r[m],p=h.length,f=Dr(t.call(l,l&&l.__data__,m,n)),P=f.length,T=a[m]=new Array(P),O=i[m]=new Array(P),Q=c[m]=new Array(p);o(l,h,T,O,Q,f,e);for(var N=0,E=0,Y,Z;N<P;++N)if(Y=T[N]){for(N>=E&&(E=N+1);!(Z=O[E])&&++E<P;);Y._next=Z||null}}return i=new d(i,n),i._enter=a,i._exit=c,i}function Dr(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Ge(){return new d(this._exit||this._groups.map(xt),this._parents)}function Ue(t,e,o){var n=this.enter(),r=this,s=this.exit();return typeof t=="function"?(n=t(n),n&&(n=n.selection())):n=n.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),o==null?s.remove():o(s),n&&r?n.merge(r).order():r}function He(t){for(var e=t.selection?t.selection():t,o=this._groups,n=e._groups,r=o.length,s=n.length,i=Math.min(r,s),a=new Array(r),c=0;c<i;++c)for(var m=o[c],l=n[c],h=m.length,p=a[c]=new Array(h),f,P=0;P<h;++P)(f=m[P]||l[P])&&(p[P]=f);for(;c<r;++c)a[c]=o[c];return new d(a,this._parents)}function Ke(){for(var t=this._groups,e=-1,o=t.length;++e<o;)for(var n=t[e],r=n.length-1,s=n[r],i;--r>=0;)(i=n[r])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function Xe(t){t||(t=$r);function e(h,p){return h&&p?t(h.__data__,p.__data__):!h-!p}for(var o=this._groups,n=o.length,r=new Array(n),s=0;s<n;++s){for(var i=o[s],a=i.length,c=r[s]=new Array(a),m,l=0;l<a;++l)(m=i[l])&&(c[l]=m);c.sort(e)}return new d(r,this._parents).order()}function $r(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Qe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Ye(){return Array.from(this)}function Ze(){for(var t=this._groups,e=0,o=t.length;e<o;++e)for(var n=t[e],r=0,s=n.length;r<s;++r){var i=n[r];if(i)return i}return null}function Je(){let t=0;for(let e of this)++t;return t}function We(){return!this.node()}function tn(t){for(var e=this._groups,o=0,n=e.length;o<n;++o)for(var r=e[o],s=0,i=r.length,a;s<i;++s)(a=r[s])&&t.call(a,a.__data__,s,r);return this}function Vr(t){return function(){this.removeAttribute(t)}}function kr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Rr(t,e){return function(){this.setAttribute(t,e)}}function Fr(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Or(t,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttribute(t):this.setAttribute(t,o)}}function qr(t,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,o)}}function en(t,e){var o=Pt(t);if(arguments.length<2){var n=this.node();return o.local?n.getAttributeNS(o.space,o.local):n.getAttribute(o)}return this.each((e==null?o.local?kr:Vr:typeof e=="function"?o.local?qr:Or:o.local?Fr:Rr)(o,e))}function _t(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Lr(t){return function(){this.style.removeProperty(t)}}function zr(t,e,o){return function(){this.style.setProperty(t,e,o)}}function Br(t,e,o){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,o)}}function nn(t,e,o){return arguments.length>1?this.each((e==null?Lr:typeof e=="function"?Br:zr)(t,e,o??"")):Gr(this.node(),t)}function Gr(t,e){return t.style.getPropertyValue(e)||_t(t).getComputedStyle(t,null).getPropertyValue(e)}function Ur(t){return function(){delete this[t]}}function Hr(t,e){return function(){this[t]=e}}function Kr(t,e){return function(){var o=e.apply(this,arguments);o==null?delete this[t]:this[t]=o}}function on(t,e){return arguments.length>1?this.each((e==null?Ur:typeof e=="function"?Kr:Hr)(t,e)):this.node()[t]}function rn(t){return t.trim().split(/^|\s+/)}function Ht(t){return t.classList||new sn(t)}function sn(t){this._node=t,this._names=rn(t.getAttribute("class")||"")}sn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function an(t,e){for(var o=Ht(t),n=-1,r=e.length;++n<r;)o.add(e[n])}function cn(t,e){for(var o=Ht(t),n=-1,r=e.length;++n<r;)o.remove(e[n])}function Xr(t){return function(){an(this,t)}}function Qr(t){return function(){cn(this,t)}}function Yr(t,e){return function(){(e.apply(this,arguments)?an:cn)(this,t)}}function mn(t,e){var o=rn(t+"");if(arguments.length<2){for(var n=Ht(this.node()),r=-1,s=o.length;++r<s;)if(!n.contains(o[r]))return!1;return!0}return this.each((typeof e=="function"?Yr:e?Xr:Qr)(o,e))}function Zr(){this.textContent=""}function Jr(t){return function(){this.textContent=t}}function Wr(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ln(t){return arguments.length?this.each(t==null?Zr:(typeof t=="function"?Wr:Jr)(t)):this.node().textContent}function ts(){this.innerHTML=""}function es(t){return function(){this.innerHTML=t}}function ns(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function un(t){return arguments.length?this.each(t==null?ts:(typeof t=="function"?ns:es)(t)):this.node().innerHTML}function os(){this.nextSibling&&this.parentNode.appendChild(this)}function fn(){return this.each(os)}function rs(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pn(){return this.each(rs)}function dn(t){var e=typeof t=="function"?t:Mt(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function ss(){return null}function hn(t,e){var o=typeof t=="function"?t:Mt(t),n=e==null?ss:typeof e=="function"?e:yt(e);return this.select(function(){return this.insertBefore(o.apply(this,arguments),n.apply(this,arguments)||null)})}function is(){var t=this.parentNode;t&&t.removeChild(this)}function Pn(){return this.each(is)}function as(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cs(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Mn(t){return this.select(t?cs:as)}function yn(t){return arguments.length?this.property("__data__",t):this.node().__data__}function ms(t){return function(e){t.call(this,e,this.__data__)}}function ls(t){return t.trim().split(/^|\s+/).map(function(e){var o="",n=e.indexOf(".");return n>=0&&(o=e.slice(n+1),e=e.slice(0,n)),{type:e,name:o}})}function us(t){return function(){var e=this.__on;if(!!e){for(var o=0,n=-1,r=e.length,s;o<r;++o)s=e[o],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++n]=s;++n?e.length=n:delete this.__on}}}function fs(t,e,o){return function(){var n=this.__on,r,s=ms(e);if(n){for(var i=0,a=n.length;i<a;++i)if((r=n[i]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=o),r.value=e;return}}this.addEventListener(t.type,s,o),r={type:t.type,name:t.name,value:e,listener:s,options:o},n?n.push(r):this.__on=[r]}}function gn(t,e,o){var n=ls(t+""),r,s=n.length,i;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,m=a.length,l;c<m;++c)for(r=0,l=a[c];r<s;++r)if((i=n[r]).type===l.type&&i.name===l.name)return l.value}return}for(a=e?fs:us,r=0;r<s;++r)this.each(a(n[r],e,o));return this}function xn(t,e,o){var n=_t(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,o):(r=n.document.createEvent("Event"),o?(r.initEvent(e,o.bubbles,o.cancelable),r.detail=o.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function ps(t,e){return function(){return xn(this,t,e)}}function ds(t,e){return function(){return xn(this,t,e.apply(this,arguments))}}function _n(t,e){return this.each((typeof e=="function"?ds:ps)(t,e))}function*An(){for(var t=this._groups,e=0,o=t.length;e<o;++e)for(var n=t[e],r=0,s=n.length,i;r<s;++r)(i=n[r])&&(yield i)}var X=[null];function d(t,e){this._groups=t,this._parents=e}function hs(){return new d([[document.documentElement]],X)}function Ps(){return this}d.prototype=hs.prototype={constructor:d,select:$e,selectAll:ke,selectChild:Fe,selectChildren:Oe,filter:qe,data:Be,enter:Le,exit:Ge,join:Ue,merge:He,selection:Ps,order:Ke,sort:Xe,call:Qe,nodes:Ye,node:Ze,size:Je,empty:We,each:tn,attr:en,style:nn,property:on,classed:mn,text:ln,html:un,raise:fn,lower:pn,append:dn,insert:hn,remove:Pn,clone:Mn,datum:yn,on:gn,dispatch:_n,[Symbol.iterator]:An};function V(t){return typeof t=="string"?new d([[document.querySelector(t)]],[document.documentElement]):new d([[t]],X)}function Kt(t){return typeof t=="string"?new d([document.querySelectorAll(t)],[document.documentElement]):new d([H(t)],X)}var F=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],Ms=["#8dd3c7","#cae9be","#ffffb3","#bebada","#e49ea5","#fb8072","#cc9ba2","#80b1d3","#fdb462","#dbca65","#b3de69","#a5d89a"];function bn(t,e,o=[]){let n=(t+e)%F.length,r=F[n];if(o&&!o.includes(r)){for(let s of o)if(r==ft.enharmonic(s))return s;return}return r}function Xt(t){let e=[];for(let o of t)e.push(Ms[Qt(o)]);return e}function Qt(t){if(F.includes(t))return F.indexOf(t);let e=ft.enharmonic(t);if(F.includes(e))return F.indexOf(e)}function vn(t){return t.replace(/b/g,"\u266D").replace(/#/g,"\u266F")}function Yt(t,e,o,n,r="#cccccc",s=null,i=null,a=null){let c=t.append("svg:circle").attr("cx",e).attr("cy",o).attr("r",n).style("fill",r);s&&c.style("stroke",s),i&&c.style("stroke-width",i),a&&c.attr("title",a)}function Zt(t,e,o){let n=e.tuning,r=e.string_gauges,s=e.fret_count,i=V(t);i.selectAll("*").remove();let c=i.node().parentElement.getBoundingClientRect().width*.95,m=26,l=140,h=m*(s+1),p=l*(s+1);c=Math.min(p,Math.max(h,c));let f=c/(s+1),P=f*.65,T=P*.1,O=f*.01,Q=f*.8,N=P*.5,E=P*n.length+N,Y=c-Q*1.2,Z=P*(n.length-1),Sn=f*.06,J=f*.23,In=J*.1,Cn=J*1.05,W=J*.3;i.attr("width",c).attr("height",E);let tt=`translate(${Q}, ${N})`,Tn=i.append("g").attr("class","frets").attr("transform",tt),Wt=i.append("g").attr("class","fret-markers").attr("transform",tt),En=i.append("g").attr("class","strings").attr("transform",tt),te=i.append("g").attr("class","notes").attr("transform",tt);for(let M=0;M<=s;M++){let v=M*f,x=Sn;M==0&&(x*=1.5),Tn.append("svg:line").attr("x1",v).attr("y1",-T/2).attr("x2",v).attr("y2",Z+T).style("stroke","#222222").style("stroke-width",x).append("title").text(M)}for(let M of e.fret_markers){if(M>s)break;let v=M*f-f/2,x=E-N-W*3;if(M%12==0){let k=W*1.3;Yt(Wt,v+k,x,W),v-=k}Yt(Wt,v,x,W)}for(let M=0;M<n.length;M++){let v=n[M],x=M*P;En.append("svg:line").attr("x1",-O/2).attr("y1",x).attr("x2",Y+O).attr("y2",x).style("stroke","#444444").style("stroke-width",r[M]*P).append("title").text(v)}for(let M=0;M<n.length;M++){let v=Qt(n[M]);for(let x=0;x<=s;x++){let k=bn(v,x,o);if(!k)continue;let ee=vn(k),Dn=5*(1-1/ee.length),$n=Cn-Dn,ne=x*f-f*.5,oe=M*P;Yt(te,ne,oe,J,"#ffffff","#999999",In,k),te.append("svg:text").attr("x",ne).attr("y",oe).attr("dy","0.33em").attr("fill","#000000").style("text-anchor","middle").style("font-size",`${$n}px`).text(ee)}}}var Jt={guitar:{tuning:["E","B","G","D","A","E"],string_gauges:[.01,.013,.017,.026,.036,.046],fret_count:15,fret_markers:[3,5,7,9,12,15,17,19,21,24]},ukulele:{tuning:["A","E","C","G"],string_gauges:[.024,.031,.037,.026],fret_count:12,fret_markers:[5,7,10,12,15,17,19]}};var At=V("#detected-chords"),jn=V("#chord-notes");function wn(t){let e=Xt(t);Zt("#fretboard",Jt.ukulele,t);for(let o in t)Kt(`#fretboard .notes circle[title="${t[o]}"]`).style("fill",e[o])}function Nn(t){At.selectAll("*").remove();let e=ut.detect(t.split(/[,\s]+/));if(e.length){let o=e.map(n=>{let r=ut.get(n.split("/")[0]);return{name:n,notes:r.notes}});At.append("h4").text("Detected"),At.append("ul").selectAll("li").data(o).join("li").text(n=>`${n.name}: ${n.notes.join(", ")}`),wn(o[0].notes)}else At.append("h4").text("No chords detected"),wn(Gt.get("A chromatic").notes)}V("#chord-detect").on("click",()=>Nn(jn.property("value")));var ys=jn.on("change",t=>Nn(t.target.value));ys.attr("value","C E G").dispatch("change");})();
