// https://github.com/yaph/traste v0.1.1 Copyright 2020 Ramiro Gómez
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-selection"],e):e((t=t||self).traste={},t.d3)}(this,(function(t,e){"use strict";let r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n={A:["G##","Bbb"],"A#":["Bb"],Ab:["G#"],B:["Cb","A##"],"B#":["C"],Bb:["A#"],C:["B#","Dbb"],"C#":["Db"],D:["C##","Ebb"],"D#":["Eb"],Db:["C#"],E:["Fb","D##"],"E#":["F"],Eb:["D#"],F:["E#","Gbb"],"F#":["Gb"],G:["F##","Abb"],"G#":["Ab"],Gb:["F#"]},l=["#fb8072","#fccde5","#fdb462","#ffed6f","#ffffb3","#b3de69","#ccebc5","#80b1d3","#bc80bd","#8dd3c7","#bebada","#d9d9d9"];function a(t,e,l=[]){let a=(t+e)%r.length,s=r[a];if(!l||l.includes(s))return s;for(let t of n[s])if(l.includes(t))return t}function s(t){if(r.includes(t))return r.indexOf(t);for(let e of n[t])if(r.includes(e))return r.indexOf(e)}function f(t,e,r,n,l="#cccccc",a=null,s=null,f=null){let i=t.append("svg:circle").attr("cx",e).attr("cy",r).attr("r",n).style("fill",l);a&&i.style("stroke",a),s&&i.style("stroke-width",s),f&&i.attr("title",f)}t.drawFretboard=function(t,r,n){let l=r.tuning,i=r.string_gauges,c=r.fret_count,o=e.select(t);o.selectAll("*").remove();let d=.95*o.node().parentElement.getBoundingClientRect().width,u=40*(c+1),b=140*(c+1);d=Math.min(b,Math.max(u,d));let g=d/(c+1),p=.65*g,h=.1*p,y=.01*g,x=.8*g,m=.5*p,A=p*l.length+m,C=d-1.2*x,E=[3,5,7,9,12,15,17,19,21,24],G=p*(l.length-1),D=.06*g,k=.22*g,B=.2*k,F=1.05*k,_=.3*k;o.attr("width",d).attr("height",A);let w=`translate(${x}, ${m})`,v=o.append("g").attr("class","frets").attr("transform",w),M=o.append("g").attr("class","fret-markers").attr("transform",w),O=o.append("g").attr("class","strings").attr("transform",w),$=o.append("g").attr("class","notes").attr("transform",w);for(let t=0;t<=c;t++){let e=t*g,r=D;0==t&&(r*=1.5),v.append("svg:line").attr("x1",e).attr("y1",-h/2).attr("x2",e).attr("y2",G+h).style("stroke","#222222").style("stroke-width",r).append("title").text(t)}for(let t of E){if(t>c)break;let e=t*g-g/2,r=A-m-3*_;if(0==t%12){let t=1.3*_;f(M,e+t,r,_),e-=t}f(M,e,r,_)}for(let t=0;t<l.length;t++){let e=l[t],r=t*p;O.append("svg:line").attr("x1",-y/2).attr("y1",r).attr("x2",C+y).attr("y2",r).style("stroke","#444444").style("stroke-width",i[t]*p).append("title").text(e)}for(let t=0;t<l.length;t++){let e=s(l[t]);for(let r=0;r<=c;r++){let l=a(e,r,n);if(!l)continue;let s=r*g-.5*g,i=t*p,c=s-.34*F,o=i+.34*F;l.length>1&&(c=s-.5*F),f($,s,i,k,"#ffffff","#aaaaaa",B,l),$.append("svg:text").attr("x",c).attr("y",o).attr("fill","#000000").style("font-size",`${F}px`).text(l.replace(/b/g,"♭").replace(/#/g,"♯"))}}},t.instruments={guitar:{tuning:["E","B","G","D","A","E"],string_gauges:[.01,.013,.017,.026,.036,.046],fret_count:15},ukulele:{tuning:["A","E","C","G"],string_gauges:[.024,.031,.037,.026],fret_count:12}},t.noteColors=function(t){switch(t.length){case 3:return[l[0],l[4],l[7]];case 4:return[l[0],l[4],l[7],l[11]];case 5:return[l[0],l[4],l[7],l[11],l[2]];case 7:return[l[0],l[2],l[4],l[5],l[7],l[9],l[11]];default:return l.slice(0,t.length)}},Object.defineProperty(t,"__esModule",{value:!0})}));
